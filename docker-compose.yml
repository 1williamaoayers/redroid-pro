version: "3"
services:
  redroid:
    container_name: redroid-pro
    # Image from GitHub Actions build
    image: ghcr.io/1williamaoayers/redroid-pro:latest
    stdin_open: true
    tty: true
    privileged: true
    ports:
      - "5555:5555"
    volumes:
      - redroid-data:/data
    environment:
      # --- ğŸš€ ç»ˆææ™®æƒ é…ç½® (Project Dream) ---

      # 1. ç©·äººæ•‘æ˜Ÿï¼šå¼€å¯ Android Go æ¨¡å¼ (é€‚åˆ 2G/4G å†…å­˜æœºå™¨)
      - ENABLE_LOW_RAM=true

      # 2. æ™ºèƒ½ç½‘ç»œï¼šè‡ªåŠ¨å¯»æ‰¾å®¿ä¸»æœºä»£ç† (æ— éœ€å¡«å†™ IP)
      # åªè¦ä½ çš„ V2RayA ç›‘å¬åœ¨ 20171ï¼Œè¿™é‡Œç•™ç©ºå³å¯è‡ªåŠ¨è¿æ¥ï¼
      - PROXY_HOST=
      - PROXY_PORT=20171

    command:
      # åˆ†è¾¨ç‡è®¾ç½®ä¸º 720Pï¼Œå…¼é¡¾ç”»è´¨ä¸æµç•…åº¦
      - androidboot.redroid_width=720
      - androidboot.redroid_height=1280
      - androidboot.redroid_dpi=320
      - androidboot.redroid_fps=30
      # é™åˆ¶å †å†…å­˜ï¼Œé˜²æ­¢ OOM
      - androidboot.redroid_vm_heap=256m
    # èµ„æºé™åˆ¶é˜²ç‚¸æœº
    deploy:
      resources:
        limits:
          memory: 4G
    restart: unless-stopped

  syncthing:
    container_name: redroid-sync
    image: syncthing/syncthing
    environment:
      - PUID=0
      - PGID=0
    volumes:
      - redroid-data:/var/syncthing/android_data
    ports:
      - "8384:8384"
      - "22000:22000/tcp"
      - "22000:22000/udp"
      - "21027:21027/udp"
    restart: unless-stopped

  scrcpy-web:
    container_name: redroid-web
    image: emptysuns/scrcpy-web:v0.1
    ports:
      - "8000:8000"
    command: [ "adb", "connect", "redroid:5555" ]
    depends_on:
      - redroid
    environment:
      - USE_H264=true
    restart: unless-stopped

volumes:
  redroid-data:
